# Choosing Your Database
* NoSQL 데이터베이스를 고려해야 할 두 가지 주요 이유를 **프로그래머 생산성**과 **데이터 액세스 성능**으로 본다. 
* 다양한 경우에 이 두 가지 요인은 서로 보완되거나 상충될 수 있다. 
* 프로젝트 초기에 이 두 가지를 평가하는 것은 어렵지만, 데이터베이스를 선택하는 일은 나중에 변경하기 어려운 문제이다.
## Programmer Productivity
* 관계형 데이터베이스로 작업하면 정보는 일반적으로 aggregate 형태로 수집되고 표현되지만, 이를 영구적으로 저장하기 위해서는 관계로 변환해야 한다.
* Aggregate 지향 데이터베이스를 사용함으로써 **ORM을 제거하고 aggregate를 자연스럽게 영구적으로 저장**할 수 있다.
* 그래프 데이터베이스는 많은 관계가 존재하는 데이터를 위해 보다 자연스로운 **데이터베이스 API를 제공**하며, 이러한 **구조에 맞춘 쿼리 기능을 제공**한다.
* 모든 NoSQL 데이터베이스는 **비정형 데이터에 더 적합**하다. 만약 임시 필드를 지원해야 한다면, 스키마가 없는 NoSQL 데이터베이스가 더 효율적일 수 있다.
* 이러한 이유로 NoSQL 데이터베이스의 프로그래밍 모델이 **개발 팀의 생산성을 향상**시킬 수 있다.
    * 첫 번째 단계는 **소프트웨어가 무엇을 해야 하는지 살펴보는 것**이다. 현재 기능을 검토하고 데이터 사용 방식이 어떻게 맞는지 확인해야 한다. 
    * 이때, **polyglot persistence는 여러 데이터베이스를 사용하는 것**을 기억해야 한다.
    * 그 다음, **실제로 소프트웨어를 구축하여 시험**해 보는 것인데, 이때 고려 중인 기술을 사용하는 것이 얼마나 쉬운지 면밀히 살펴보면서 초기 기능을 일부 구축해보는 것이 좋다. 이는 **특정 프레임워크의 효율성을 평가하는 데 필수적인 방법**이다.
    * 서로 다른 설계 과정의 생산성을 정확하게 측정하는 방법은 없다. 
## Data-Access Performance
*  Aggregate 지향 데이터베이스는 많은 테이블에 분산된 데이터를 가지고 있는 관계형 데이터베이스에 비해 **aggregate를 읽거나 검색하는 속도가 매우 빠를 수 있다**. 
* Cluster에서 쉬운 **샤딩과 복제는 수평 확장을 가능**하게 하고, 그래프 데이터베이스는 관계형 조인을 사용하는 것보다 **강하게 연결된 데이터를 더 빠르게 검색**할 수 있다.
* 성능을 기준으로 NoSQL 데이터베이스를 찾고 있다면, 가장 중요한 것은 **시나리오에서 성능을 테스트하는 것**이다.
    * 성능을 제대로 평가하는 유일한 방법은 **무언가를 구축하고, 실행하고, 측정하는 것**이다.
    * 테스트 진행 시, 실제 시스템을 구축할 수 없기 때문에 **전체 데이터를 대표하는 subset을 구축**해야 한다.
    * 공용 웹사이트를 구축하는 경우, **클라우드 컴퓨팅 리소스를 사용하여 load를 생성하고 테스트 cluster를 구축**하는 것이 좋다. 클라우드 provisioning의 탄력적인 특성은 단기적인 성능 평가 작업에 매우 유용하다.
## Sticking with the Default
* NoSQL 데이터베이스가 많은 상황에서 유용한 옵션일 수 있지만, 관계형 데이터베이스를 고수하는 것이 더 나은 경우 또한 많다.
* 만약 NoSQL 데이터베이스를 선택하려면 NoSQL 데이터베이스 선택이 관계형 데이터베이스보다 실질적인 이점을 보여야 한다.
## Hedging Your Bets
* 상황이 불확실할 때, 데이터베이스 코드를 codebase에서 상대적으로 쉽게 교체할 수 있는 부분에 유지하는 것이 좋다. 
* 고전적인 방법은 **명시적인 데이터 저장 계층을 애플리케이션에 사용하는 것**으로, 데이터 mapper와 repository와 같은 패턴을 사용하는 것이다. 이때 insulating 계층의 비용에 주의해야 한다.
* 이러한 설계 방법은 관계형 데이터베이스를 사용할 경우에도 마찬가지이다. **데이터베이스의 segment를 서비스로 캡슐화**함으로써, 데이터 저장 기술이 효율적이고 이점이 명확해짐에 따라 NoSQL 기술로 전환할 수 있다.
